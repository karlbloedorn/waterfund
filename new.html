<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
	<meta name="viewport" content="initial-scale=1">
    <title data-i18n="appname-title"></title>
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.css">  
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" crossorigin=""/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Encode+Sans" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css" />    
    <link rel="stylesheet" href="site.css" />
    <style>
        .footer.segment {
            padding: 5em 0em;
         }
        .itemsection{
            margin-bottom: 50px;
        }
        .background_text{
            padding-top: 1em;
            font-size: 1.5em;
            font-family: 'Encode Sans', sans-serif;
            color: #9E9E9E;
        }
        .person_quote_name{
            display: block;
            padding-top: 0.5em;
            padding-left: 0.5em;
            font-size: 1.5em;
            font-family: 'Encode Sans', sans-serif;
            color: black;
        }
        .sectionheader{
            font-weight: 100 !important;
            font-family: 'Encode Sans', sans-serif !important;
            font-size: 2em !important;
            color: black !important;
        }
        .itemquote{
            font-size: 1.2em !important;
        }
        .gallery-picture{
            margin: 4px;
        }
       .highlighted_word{
           cursor: pointer;
       }
       .person_card{
           cursor: pointer;
       }
    </style>
</head>
<body>
    <div id="detail_modal" class="ui longer modal">
        <div id="detail_modal_header" class="header">
        </div>
        <div id="detail_modal_scrollarea" class="scrolling image content">
            <div class="ui large rounded image">
                <img id="detail_modal_profile_image" class='img-circle selected'>
            </div>
            <div class="description">
                <p class=''><span id="detail_modal_story"></span></p>
                <div id="detail_modal_gallery" class="gallery">
                </div>  
            </div>
        </div>
        <div class="actions">
            <div class="ui primary approve button">
            Close
            <i class="right chevron icon"></i>
            </div>
        </div>
    </div>

     <canvas class='visible-lg-block visible-md-block' id="lineOverlay"></canvas>      
     <section id="introSection" class="full-screen">
        <div id='video'>
        </div>
        <div id="titlecontent">
            <span data-i18n="project_title"></span>
            <h3><span data-i18n="project_subtitle"></span></h3>
        </div>   
        <div id="lang_buttons">
            <button id='lang_english' class="ui black button">
                    English
            </button>
            <button  id='lang_espanol' class="ui black button">
                    Espa√±ol
            </button>
        </div>
    </section>
    <br><br><br>
    <div class="ui container">
        <h2 class="ui header sectionheader">
            <span data-i18n="background_title"></span>
        </h2>
        <div class="ui grid">
            <div class="ten wide computer only column">
                <p class='background_text'><span data-i18n="[html]background_intro"></span>
                </p>
                <p class='background_text'><span data-i18n="[html]background_watersheds"></span>
                </p>
                <p class='background_text'><span data-i18n="[html]background_subwatersheds"></span>
                </p>
            </div>
            <div class="six wide computer only column">
                <div id="map" class='visible-md-block visible-lg-block'></div>
            </div>    
            
            <div class="sixteen wide mobile tablet only column">
                    <p class='background_text'><span data-i18n="[html]background_intro"></span>
                    </p>
                    <br>
                    <img class="ui centered medium image" src="img/testmap/1.png">
                
                    <p class='background_text'><span data-i18n="[html]background_watersheds"></span>
                    </p>
                    <br>
                    <img class="ui centered medium image" src="img/testmap/2.png">
                                        
                    <p class='background_text'><span data-i18n="[html]background_subwatersheds"></span>
                    </p>
                    <br>
                    <img class="ui centered medium image" src="img/testmap/4.png">                    
                    
            </div>
        </div>
    </div>
    <br><br>
    <div id='sections'>
    </div>
    <br>
    <br>
    <center>
        <div class="ui small images">
            <a href="https://www.naturalcapitalproject.org/" class="ui medium image">
                <img style="width:128px;height:128px;" class="ui medium image" src="img/logos/logo_natcap.png"/>
            </a>
            <a href="http://environment.umn.edu/" class="ui medium image">
                <img style="width:128px;height:128px;" class="ui medium image" src="img/logos/logo_ione.png"/>
            </a>
            <img style="width:128px;height:128px;" class="ui medium image" src="img/logos/logo_fondo_de_agua.png"/>
            <a href="https://twitter.com/asobolo?lang=en" class="ui medium image">
                <img style="width:128px;height:128px;" class="ui medium image" src="img/logos/logo_asobolo.png"/>
            </a>
            <a href="https://woods.stanford.edu/" class="ui medium image">
                <img style="width:128px;height:128px;" class="ui medium image" src="img/logos/logo_stanford.png"/>
            </a>
        </div>
    </center>
    <br>
    <div class="ui inverted vertical footer segment">
        <div class="ui container">
            <div class="ui stackable inverted divided equal height stackable grid">
            <div class="three wide column">
                <h4 class="ui inverted header">About</h4>
                <div class="ui inverted link list">
                <a href="#" class="item">Contact Us</a>
                <a href="#" class="item">Funding</a>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header">Social Media</h4>
                <div class="ui inverted link list">
                    
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header">Footer Header</h4>
                <p>Extra space for a call to action inside the footer that could help re-engage users.</p>
            </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" crossorigin=""></script>
    <script src="lib/jquery.i18n.js"></script>
    <script src="lib/jquery.i18n.messagestore.js"></script>
    <script src="lib/jquery.i18n.fallbacks.js"></script>
    <script src="lib/jquery.i18n.parser.js"></script>
    <script src="lib/jquery.i18n.emitter.js"></script>
    <script src="lib/jquery.i18n.language.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>    
    <script>
        $(document).ready(function(){
            var data=[{items:[{key:"amalia",images:["DSC00041","DSC00492","101_1665","108_7672","DSC07261","DSC07278"]}]},{items:[{key:"guido",images:["DSC00314","DSC00330","DSC00339","DSC05337","P1010071"]},{key:"school",images:["DSC00157","DSC00134","DSC00136","DSC00143"]},{key:"manuel",images:["DSC02800","DSC02784","DSC02791","P1010911","P1010913"]},{key:"community",images:["DSC00078","DSC00089","DSC00093","DSC00115","DSC00123"]}]},{items:[{key:"diego",images:["DSC00428","DSC00446","P1030766","P1030882","P1050733"]},{key:"humberto",images:["DSC00374","108_6873","108_7543","108_7546","P1100449","108_7536"]},{key:"oscar",images:["DSC00500","DSC00507","DSC00509","DSC00531"]}]},{items:[{key:"otoniel",images:["DSC00426","P1140705","P1140712","P1160183","P1160992"]},{key:"ediberto",images:["DSC00021","DSC00032","P1080776","P1120067","108_7313"]},{key:"trujillo",images:["P1090557","P1100233","P1100235","P1100374","P1100398"]}]},{"items" :[]}];
            var mapTriggers=[
                {triggerElement:"#item_colombia",mapZoomLevel:4,minLatitude:-5,maxLatitude:15,minLongitude:-79.85,maxLongitude:-65.833,color:"#fec44f",leftLatitude:4.166858,leftLongitude:-77.525039,pane:"colombia"},
                {triggerElement:"#item_cauca_river",mapZoomLevel:6,minLatitude:.9,maxLatitude:5.30535,minLongitude:-78.213,maxLongitude:-75.48148,color:"#7fcdbb",pane:"departments"},
                {triggerElement:"#item_fifteen_watersheds",mapZoomLevel:8,minLatitude:2.649586,maxLatitude:5.25117,minLongitude:-76.869759,maxLongitude:-75.70077,color:"#31a354",pane:"fund"},
                {triggerElement:"#item_asobolo",mapZoomLevel:10,minLatitude:3.34986,maxLatitude:3.60117,minLongitude:-76.491,maxLongitude:-76.030077,color:"#c51b8a",pane:"fund"}];
            
            // Add all the sections
            var sections = $("#sections");
            _.each(data, function(section, sectionIndex){
                var section_container = $("<div class='ui container itemsection' >");
                var section_header = $("<h2 class='ui header sectionheader'>");
                var section_header_text = $("<span>");
                $(section_header_text).attr('data-i18n', 'section_header_' + (sectionIndex+1));
                $(section_container).append(section_header);
                $(section_header).append(section_header_text);
                var item_container = $("<div class='itemcontainer'>");

                //var item_container = $("<div class='itemcontainer ui divided link items'>");
                $(section_container).append(item_container);

                // Add each item in the section
                _.each(section.items, function(item, itemIndex){


                    // list item style
                    /* var item_div = $("<div class='item'>");
                    $(item_container).append(item_div);
                    var profile_image_wrapper = $("<div class='ui circular small image'>");
                    var profile_image = $("<img>");
                    $(profile_image).attr('src', 'people/' + item.key + ".png");
                    $(profile_image_wrapper).append(profile_image);
                    $(item_div).append(profile_image_wrapper);
                    var item_content = $("<div class='content'>");
                    $(item_div).append(item_content);
                    var item_header = $("<div class='header'>");
                    $(item_header).attr('data-i18n', 'person_name_' + item.key);
                    $(item_content).append(item_header);
                    var item_description = $("<div class='description'>");
                    $(item_description).attr('data-i18n', 'person_quote_' + item.key);
                    $(item_content).append(item_description);
                    var item_extra = $('<div class="extra">');
                    $(item_content).append(item_extra);
                    var item_right_button = $('<div class="ui right floated button">');
                    $(item_extra).append(item_right_button);
                    var item_button_text = $("<i class='chevron right icon'></i> <span class='learnmore' data-i18n='learn_more'></span>");
                    $(item_right_button).append(item_button_text);*/

                    var item_div = $("<div class='person_card ui clearing raised segment'>");
                    $(item_container).append(item_div);
                    //$(item_div).html("<p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.</p></div>");
                 

                

                    var profile_image_wrapper = $("<div class='ui circular right small image floated'>");
                    var profile_image = $("<img>");
                    $(profile_image).attr('src', 'people/' + item.key + ".png");
                    $(item_div).append(profile_image_wrapper);
                    $(profile_image_wrapper).append(profile_image);

                    var item_description = $("<span class='background_text description'>");
                    $(item_description).attr('data-i18n', 'person_quote_' + item.key);
                    $(item_div).append(item_description);

                    var person_header = $("<span class='person_quote_name'></span>");
                    $(person_header).attr('data-i18n', 'person_name_' + item.key);
                    $(item_div).append(person_header);

                    var gallery = $("<div class='summary_gallery gallery'>");
                    $(item_div).append(gallery);

                    _.each(item.images, function(image, imageIndex){
                            var image_link = $("<a>");
                            $(image_link).attr("data-fancybox", item.key);
                            $(image_link).attr("data-translate-caption", 'caption_' + item.key + '_' + (imageIndex +1));
                            $(image_link).attr("href", 'img/' +item.key + '/' + image + '.JPG');
                            $(gallery).append(image_link);

                            var img = $("<img class='gallery-picture'>");
                            $(img).attr('src', 'img/' +item.key + '/' + image + '_tn.JPG');
                            $(image_link).append(img);
                            $(img).css('height', '80px' );
                    });

                    $(item_div).click(function(e){

                        if($(e.target).hasClass('gallery-picture')){
                            return;

                        }

                        $("#detail_modal_story").html( $.i18n( 'person_story_' + item.key, { 'interpolation': {'escapeValue': false} } ));
                        $("#detail_modal_header").html($.i18n('person_name_' + item.key));
                        $("#detail_modal_profile_image").attr("src", 'people/' + item.key + ".png");
                        $("#detail_modal_gallery").html("");

                        _.each(item.images, function(image, imageIndex){
                            var image_link = $("<a>");
                            $(image_link).attr("data-fancybox", item.key);
                            $(image_link).attr("data-translate-caption", 'caption_' + item.key + '_' + (imageIndex +1));
                            $(image_link).attr("href", 'img/' +item.key + '/' + image + '.JPG');
                            $("#detail_modal_gallery").append(image_link);

                            var img = $("<img class='gallery-picture'>");
                            $(img).attr('src', 'img/' +item.key + '/' + image + '_tn.JPG');
                            $(image_link).append(img);
                            $(img).css('height', '80px' );
                        });

                        $(".gallery").children().each(function () {
                            var captionKey =  $(this).data("translate-caption");
                            if(captionKey != null){
                                $(this).data("caption",  $.i18n(captionKey));
                            } else {
                                console.log(captionKey);
                                $(this).data("caption",  'CAPTION NEEDED');
                            }
                        });
                        $('#detail_modal').i18n();
                        $('#detail_modal').modal({
                            onHide: function(){
                                $("#detail_modal_scrollarea").scrollTop(0);
                            }
                        }).modal('show');
                        
                           
                    });
                });
                $(sections).append(section_container);
            });

            $.i18n.debug = false;

            var selectedLanguage = localStorage.getItem('language');
            if(selectedLanguage != null){
                $.i18n().locale = selectedLanguage;
                //$("#lang-select").val(selectedLanguage);
            } else {
                $.i18n().locale = 'en';
            }

            /*
            TODO slideshow
            var images=new Array('img/DSC00562_optimized.jpg','img/manuel/DSC02784.JPG',);
            var nextimage=0;
            doSlideshow();

            function doSlideshow(){
                if(nextimage>=images.length){
                    nextimage=0;
                }
                $('#video').css('background-image', "url('" + images[nextimage++]+ "')");
                //setTimeout(doSlideshow,2000);
            }*/

            function addGeoJsonToMap(map, filename, pane, styleFunc){
                $.getJSON(filename, function(json) {
                    var layer = L.geoJSON(json, {
                        style: styleFunc,
                        pane: pane
                    }).addTo(map);
                });
            }

            $.i18n().load( {
                en: 'i18n/en.txt',
                es: 'i18n/es.txt'
             }).done( function() {

                function renderLanguage(){
                    $('body').i18n();
                    $(".highlighted_word").append(" <i class='location arrow blue icon'></i>");
                }
                renderLanguage();

                // set up the language selector
                $("#lang_english").click(function() {
                    localStorage.setItem('language', 'en');
                    $.i18n().locale = 'en';
                    renderLanguage();
                });

                 $("#lang_espanol").click(function() {
                    localStorage.setItem('language', 'es');
                    $.i18n().locale = 'es';
                    renderLanguage();
                });

                var map = L.map('map').setView([3.41, -76.24], 3);
                L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                }).addTo(map);
                map.scrollWheelZoom.disable();
                
                var pane_colombia = map.createPane('colombia');
                var pane_departments = map.createPane('departments');
                var pane_fund = map.createPane('fund');
                var pane_polygons = map.createPane('test');

                addGeoJsonToMap(map, "data/Col_limits.txt", 'colombia', function(){
                    return {  
                        weight: 4,
                        opacity: 1,
                        color: '#fec44f', 
                        fillOpacity: 0.0,
                    };
                });

                addGeoJsonToMap(map, "data/Dep_fondo.txt", 'departments', function(){
                    return {  
                        weight: 3,
                        opacity: 1,
                        color: '#7fcdbb', 
                        fillOpacity: 0.0 
                    };
                });

                addGeoJsonToMap(map, "data/Fondo_work_areas.txt", 'fund', function(feature, i){
                    if(feature.properties.NOM_CUENCA === 'Bolo'){
                        return  {  
                            weight: 1, 
                            opacity: 1,  
                            color: 'white', 
                            fillOpacity: 0.7,
                            fillColor: "#c51b8a",
                        };
                    } else {
                        return  {  
                            weight: 1, 
                            opacity: 1,  
                            color: 'white', 
                            fillOpacity: 0.7,
                            fillColor: "#31a354",
                        };  
                    }
                });

                _.each(mapTriggers, function(mapTrigger, i){

                    var polygon = L.polygon([
                        [mapTrigger.minLatitude , mapTrigger.minLongitude],
                        [mapTrigger.minLatitude ,  mapTrigger.maxLongitude],
                        [ mapTrigger.maxLatitude,  mapTrigger.maxLongitude],
                        [ mapTrigger.maxLatitude,  mapTrigger.minLongitude],
                    ], {
                        color: "#FFF",
                        fillColor: "#000000",
                        fillOpacity: 0.0,
                        weight: 3,
                        pane: 'test'
                    });

                    $(mapTrigger.triggerElement).hover(
                        function() {
                            map.stop()	
                            map.setView([3.41, -76.24], mapTrigger.mapZoomLevel); 
                            polygon.addTo(map);
                        }, function() {
                            polygon.removeFrom(map);
                        }
                    );
                });
            });        
        });
    </script>
</body>
</html>

